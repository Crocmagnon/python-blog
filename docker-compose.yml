version: '2.4'
services:
  django:
    image: crocmagnon/blog:latest
    build:
      context: .
      args:
        POETRY_OPTIONS: "--no-dev"
    env_file:
      - envs/local.env
    volumes:
      - ./db:/db
      - staticfiles:/app/staticfiles
      - media:/app/media
    restart: on-failure
    init: true
    tty: true
    depends_on:
      - nginx
  nginx:
    image: nginx:1.19.2
    ports:
      - 8000:80
    volumes:
      - staticfiles:/app/static
      - media:/app/media
      - ./docker/nginx-dev.conf:/etc/nginx/conf.d/default.conf

volumes:
  staticfiles: {}
  media: {}
