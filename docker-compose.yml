version: '2.4'
services:
  django:
    image: rg.fr-par.scw.cloud/crocmagnon/blog:latest
    build: .
    env_file:
      - .env
    volumes:
      - ./db:/db
      - staticfiles:/app/staticfiles
      - media:/app/media
    restart: on-failure
    init: true
    tty: true
    depends_on:
      - nginx
  nginx:
    image: nginx:1.19.2
    ports:
      - 8000:80
    volumes:
      - staticfiles:/app/static
      - media:/app/media
      - ./docker/nginx.conf:/etc/nginx/conf.d/default.conf
  tests:
    image: rg.fr-par.scw.cloud/crocmagnon/blog:tests
    build:
      context: .
      dockerfile: tests.Dockerfile

volumes:
  staticfiles: {}
  media: {}
